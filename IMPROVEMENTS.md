# Улучшения проекта

## Реализованные улучшения

### 1. ML модель для извлечения полей ✅

**Реализация:**
- Создан класс `FieldExtractionModel` в `backend/app/models/ml_model.py`
- Комбинированный подход: паттерны + ML
- Использование TF-IDF и логистической регрессии
- Автоматическое сохранение и загрузка модели

**Преимущества:**
- Более точное извлечение полей
- Возможность обучения на реальных данных
- Комбинация с regex для максимальной точности

### 2. Расширенный список полей ✅

**Добавленные поля:**
- Валюта
- НДС
- Сумма прописью
- Договор/соглашение
- Срок оплаты

**Всего извлекаемых полей:**
- Основные: номер счета, дата, сумма
- Плательщик: наименование, ИНН, КПП
- Получатель: наименование, ИНН, КПП
- Банковские реквизиты: БИК, р/с, наименование банка
- Дополнительные: валюта, НДС, сумма прописью, договор, срок оплаты
- Назначение платежа

### 3. Система обучения модели ✅

**API Endpoint:**
- `POST /api/v1/train-model` - обучение модели на примерах

**Функциональность:**
- Прием примеров с текстом и ожидаемыми полями
- Обучение модели на предоставленных данных
- Автоматическое сохранение обученной модели

**Jupyter Notebook:**
- `notebooks/model_training.ipynb` - демонстрация процесса обучения

### 4. Оптимизация производительности ✅

**Кэширование:**
- In-memory кэш для результатов обработки PDF
- Кэш по хешу файла (MD5)
- LRU стратегия (Least Recently Used)
- Максимальный размер кэша: 50 записей

**Метрики производительности:**
- Endpoint `/api/v1/performance` - получение метрик
- Отслеживание:
  - Общее количество запросов
  - Успешные/неуспешные запросы
  - Среднее время обработки
  - Cache hit rate
  - Количество попаданий/промахов кэша

**Оптимизации:**
- Кэширование результатов обработки
- Измерение времени обработки
- Автоматическое переключение между парсингом и OCR

## Технические детали

### ML Модель

**Архитектура:**
- TF-IDF векторизация текста
- Логистическая регрессия для классификации
- Комбинация с regex паттернами

**Обучение:**
- Формат данных: список кортежей (текст, ожидаемые поля)
- Автоматическое сохранение модели
- Возможность дообучения

### Кэширование

**Алгоритм:**
- LRU (Least Recently Used)
- Хеширование файлов через MD5
- In-memory хранение

**Преимущества:**
- Быстрый ответ для повторных запросов
- Снижение нагрузки на OCR/парсинг
- Улучшение производительности

### Метрики

**Отслеживаемые показатели:**
- `total_requests` - общее количество запросов
- `successful_requests` - успешные запросы
- `failed_requests` - неуспешные запросы
- `average_processing_time` - среднее время обработки (секунды)
- `cache_hit_rate` - процент попаданий в кэш
- `cache_hits` - количество попаданий
- `cache_misses` - количество промахов

## Использование

### Обучение модели

```python
import requests

url = "http://localhost:8000/api/v1/train-model"
data = {
    "examples": [
        {
            "text": "Плательщик: ООО Пример ИНН: 1234567890 Сумма: 10000.00",
            "expected_fields": {
                "плательщик": {"наименование": "ООО Пример", "ИНН": "1234567890"},
                "сумма": "10000.00"
            }
        }
    ]
}

response = requests.post(url, json=data)
print(response.json())
```

### Просмотр метрик

```bash
curl http://localhost:8000/api/v1/performance
```

### Сброс метрик

```bash
curl -X POST http://localhost:8000/api/v1/performance/reset
```

## Дальнейшие улучшения

### Возможные направления:

1. **Улучшение ML модели:**
   - Использование трансформеров (BERT, LayoutLM)
   - Fine-tuning на датасете платежных счетов
   - Использование специализированных библиотек (docTR)

2. **Расширение кэширования:**
   - Redis для распределенного кэша
   - Персистентное хранение кэша
   - TTL для записей кэша

3. **Оптимизация OCR:**
   - Предобработка изображений
   - Использование GPU для OCR
   - Параллельная обработка страниц

4. **Мониторинг:**
   - Prometheus метрики
   - Grafana дашборды
   - Алерты на ошибки

5. **Тестирование:**
   - Unit тесты
   - Integration тесты
   - Тесты производительности

